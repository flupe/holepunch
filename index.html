<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>holepunch</title>
    <style>
body {
  text-align: justify;
  font-size: 16px;
  font-family: monospace;
  background: #eee;
  max-width: 1860px;
  margin: 0 auto;
  padding: 30px 20px;
  line-height: 1.54;

  display: grid;
  gap: 30px;
  grid-template: "controls card meta" / 1fr 2fr 1.5fr;

}

p { margin: 0 0 1em }

hr {
  margin: 1rem 0;
  opacity: .2;
  border: none;
  border-bottom: 3px dotted #000;
}

dt { font-style: italic; font-weight: bold }
dd { margin-left: 2ch }
dd + dt { margin-top: 1em }

#meta {padding-top: 20px}
main {
  padding-top: 20px;

  > section {
    position: sticky;
    top: 1rem;
    left: 0;
    right: 0;
  }

  header {
    h1 {
      font-size: 44px;
      margin: 0 0 40px;
      .dotted {
        display: flex;
        justify-content: right;
      }
      ruby { ruby-position: under }
      rt   {}
    }

  }

  canvas {
    display: block;
    width: 100%;
    height: auto;
    image-rendering: pixelated;
  }

  label { }

  input[type="file"] {
    margin: 1rem 0;
    font-family: monospace;
    display: block;
    &::file-selector-button {
      font-family: monospace;
      border-radius: 0;
      border-width: 1px;
      padding: .5rem;
      margin-right: 1rem;
      cursor: pointer;
    }
  }

  input[type="checkbox"], label {
    cursor: pointer;
    user-select: none;
  }

  input[type="number"] {
    padding: 5px;
    width: 60px;
  }

}

#fileinfo { display: none }

#fileinfo_yarns {
  list-style-type: upper-alpha;

  li span {
    display: inline-block;
    width: 12px;
    height: 12px;
    border: 1px solid #000;
  }
}

#punchcard {
  display: grid;
  max-width: 740px;
  height: auto;
  background: #fff;
  grid-template-columns: auto repeat(24, 1fr);
  grid-auto-rows: min-content;
  border: 2px solid #aaa;
  border-radius: 8px;
  padding: 40px 30px;
  gap: 2px;
  box-shadow:
    0 5px 10px rgba(0, 0, 0, 0.1),
    0 2px  2px rgba(0, 0, 0, 0.1);

  /* infos are offset to be displayed slightly before the line of effect */
  span.info {
    display: block;
    grid-column: 1;
    padding-right: 10px;
    position: relative;
    top: 50%;
  }

  :nth-child(24n + 1 of span.hole) { grid-column-start: 2 }

  span.hole {
    padding: 0;
    display: flex;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    justify-content: center;
    align-items: center;

    &.punched {
      background: #000;
    }


    &:not(.punched) {
      border: 1px solid #aaa;
      &::after {
        content: '';
        display: block;
        background: #aaa;
        width: 20%;
        aspect-ratio: 1 / 1;
        border-radius: 50%;
      }
    }
  }
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

#meta {
  grid-area: meta;
  h2 {
    font-size: inherit;
  }
}

@media (max-width: 1440px) {
  body {
    grid-template:
      "controls card"
      "meta meta" / 1fr 2fr;
  }

  #meta { padding-top: 0 }
}

    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>
          <span class="sr-only">holepunch</span>
          <span class="dotted" aria-hidden="true">
            <ruby>⠓<rt>h</rt></ruby>
            <ruby>⠕<rt>o</rt></ruby>
            <ruby>⠇<rt>l</rt></ruby>
            <ruby>⠑<rt>e</rt></ruby>
            <ruby>⠏<rt>p</rt></ruby>
            <ruby>⠥<rt>u</rt></ruby>
            <ruby>⠝<rt>n</rt></ruby>
            <ruby>⠉<rt>c</rt></ruby>
            <ruby>⠓<rt>h</rt></ruby>
          </span>
        </h1>
        <p>
        <em>holepunch</em> is a small utility for generating knitting machine punchcards from custom designs.
        It is especially useful for <em>double jacquard</em> patterns.</p>
      </header>
      <section>
        <hr>
        <label for=filepick>Load an image or <a href="https://www.aseprite.org/">.aseprite</a> file:</label><br>
        <input type="file" id="filepick" accept=".aseprite,image/*">
        <hr>
        <section id="fileinfo">
          <p>
            Dimensions:   <span id="fileinfo_dims"></span><br>
            Pixel ratio:  <span id="fileinfo_ratio"></span><br>
            Palette size: <span id="fileinfo_pal"></span>
          </p>
          <ol id="fileinfo_yarns"></ol>
          <hr>
          <form>
            <input checked id="double_jacquard" type="checkbox">
            <label for="double_jacquard">Double Jacquard</label>
            <br>
            <label for="card_offset">Labeling offset:</label>
            <input checked id="card_offset" type="number" value="4" min="0">
          </form>
          <hr>
          <canvas id="canvas"></canvas>
        </section>
      </section>
    </main>
    <section id="punchcard"></section>
    <section id="meta">
      <h2>How to use the tool?</h2>
      <p>Import an image or Aseprite file and play around with the parameters of the tool.
         Beware, Aseprite loading is still experimental, and there are many limitations.
         This has only been tested on files with a <em>single layer</em>, using <em>indexed coloring</em>.</p>

      <p>Here's an explanation of the parameters:</p>

      <dl>
        <dt>Labeling offset</dt>
        <dd>When a punchcard is inserted in a knitting machine, the information that is visible in the margin, at the level of the card slot,
          actually pertains to the row of stitches currently being read by the machine, a few rows below.<br>
          This parameter controls this offset. For an Erka 25, this should be set to 4.</dd>

        <dt>Double Jacquard</dt>
        <dd>Whether to produce a punchcard for double jacquard. If such is the case, the fabric is to be knitted with a ribber, alternating between colours every two rows.</dd>
      </dl>
      <hr>
      <h2>How to use a double jacquard punchcard?</h2>
      <p>When knitting double jacquard fabric using a ribber, only a single thread of yarn can be knitted at once.
         Hence the punchcard transform: we alternate between the two colors repeatedly.
         For every row, we first knit some stitches using one color, and then knit every other stitches using the other yarn.
        </p>
      <hr>
      <h2>Contributing</h2>
      <p>This tool was made during the weekend. If you want to report a bug, or help improve the tool, feel free to head over to <a href="https://github.com/flupe/holepunch">Github</a>.</p>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako_inflate.min.js" integrity="sha512-mlnC6JeOvg9V4vBpWMxGKscsCdScB6yvGVCeFF2plnQMRmwH69s9F8SHPbC0oirqfePmRBhqx2s3Bx7WIvHfWg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="main.js"></script>
  </body>
</html>
